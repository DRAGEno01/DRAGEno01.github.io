import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";import { getAuth, signInWithPopup, GoogleAuthProvider } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";import { getFirestore, addDoc, collection, onSnapshot, doc, getDocs, query, where, } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";const firebaseConfig = {apiKey: "AIzaSyChVEPH5BqCy-mUzPx0vXhcKHEO56Qgv2M",authDomain: "drage-chat.firebaseapp.com",projectId: "drage-chat",storageBucket: "drage-chat.appspot.com",messagingSenderId: "946400520996",appId: "1:946400520996:web:3f7a6caf2bef6913dfa1b1"};
const app = initializeApp(firebaseConfig);const db = getFirestore(app);const auth = getAuth(app);auth.languageCode = 'en';const date = new Date();let day = date.getDate();let month = date.getMonth() + 1;let year = date.getFullYear();let currentDate = `${day}-${month}-${year}`;let setName = date.toJSON().slice(0, 19).replace(":", ".").replace(":", "").replace("-", "").replace("-", "").replace(".", "");const provider = new GoogleAuthProvider();const joinButton = document.getElementById("joinButton");const usernameInput = document.getElementById("usernameInput");const messageInput = document.getElementById("messageInput");const sendButton = document.getElementById("sendButton");const joinView = document.getElementById("joinView");const chatsView = document.getElementById("chatsView");let messages = [];let specifiedUsername = "";let userLoggedIn = false;let uid;let email;let adminStatus = false;let shouldScroll = true;let datenow;joinButton.addEventListener("click", () => {specifiedUsername = usernameInput.value;if (!specifiedUsername) {alert("Username cannot be empty");return;}signInWithPopup(auth, provider).then(async (result) => {const credential = GoogleAuthProvider.credentialFromResult(result);const token = credential.accessToken;const user = result.user;uid = user.uid;email = user.email;if (staffEmails.includes(email)) {document.getElementById("body").style.backgroundColor = "#333";adminStatus = true;}if (specifiedUsername == "DRAGEno01" && adminStatus == false) {specifiedUsername = Math.round(Math.random() * 1000000);}joinView.classList.add("hidden");chatsView.classList.remove("hidden");userLoggedIn = true;await loadHistoricalMessages();await subscribeToNewMessages();writeMessagesArray();}).catch((error) => {const errorCode = error.code;const errorMessage = error.message;const email = error.customData.email;const credential = GoogleAuthProvider.credentialFromError(error);console.log(errorCode, errorMessage);if(errorCode == "auth/user-disabled"){setTimeout(() => {alert("This account is currently banned from our system.")}, 100);}});});sendButton.addEventListener("click", async () => {if (auth.currentUser) {auth.currentUser.reload().then(async user => {const message = messageInput.value;if (!message == "") {sendButton.style.display = "none";setTimeout(() => {sendButton.style.display = "block";}, 12500);messageInput.value = "";datenow = new Date();const docRef = await addDoc(collection(db, "messages"), {user: specifiedUsername,message: message,created: datenow,uid: uid,email: email,staff: adminStatus,});}}).catch(error => {alert("You are currently unable to send message. Login again to continue.");window.location.href = window.location.href});}});function subscribeToNewMessages() {const q = query(collection(db, "messages"));const unsubscribe = onSnapshot(q, (querySnapshot) => {const newMessages = [];querySnapshot.forEach((doc) => {newMessages.push({id: doc.id,...doc.data(),});});let existingMessageHash = {};for (let message of messages) {existingMessageHash[message.id] = true;}for (let message of newMessages) {if (!existingMessageHash[message.id]) {messages.push(message);}}let allowShowID = false;if (adminStatus == true) {allowShowID = true}if (allowShowID) {writeMessagesArray(true);} else {writeMessagesArray(false);}});};let staffEmails = ["drageno110@gmail.com"];async function loadHistoricalMessages() {messages = [];const querySnapshot = await getDocs(collection(db, "messages"));querySnapshot.forEach((doc) => {messages.push({id: doc.id,...doc.data(),});});console.log(messages);return messages.sort((a, b) => {if (a.created > b.created) {return 1} else if (a.created < b.created) {return -1} else {return 0}});}function writeMessagesArray(arg) {const html = [];for (let message of messages) {if (arg == true) {html.push(messageTemplate(message.message, message.user, message.created, true, message.uid));} else {html.push(messageTemplate(message.message, message.user, message.created, false, message.uid));}}document.getElementById("messageList").innerHTML = html.join("");if (shouldScroll) {document.getElementById('messageListdiv').scrollTop = (document.getElementById('messageListdiv').scrollHeight)}}function messageTemplate(message, username, timestamp, showID, id) {if (shouldScroll) {document.getElementById('messageListdiv').scrollTop = (document.getElementById('messageListdiv').scrollHeight)}if (showID) {return `<li><div class="flex space-x-2 pl-2 pt-2"><div class="flex flex-col"><div class="flex items-baseline space-x-2"><div class="text-sm font-bold">${username}</div><div class="text-sm text-gray-400">${new Date(timestamp.seconds * 1000).toLocaleDateString() +" " +new Date(timestamp.seconds * 1000).toLocaleTimeString()}</div></div><div class="text-sm text-gray-500">${message}</div><p class="showUserId" id="messageID">${id}</p></div></div></li>`;} else {return `<li><div class="flex space-x-2 pl-2 pt-2"><div class="flex flex-col"><div class="flex items-baseline space-x-2"><div class="text-sm font-bold">${username}</div><div class="text-sm text-gray-400">${new Date(timestamp.seconds * 1000).toLocaleDateString() +" " +new Date(timestamp.seconds * 1000).toLocaleTimeString()}</div></div><div class="text-sm text-gray-500">${message}</div></div></div></li>`;}}document.getElementById("messageListdiv").setAttribute('scrolling', 'yes');function scrolloption() {if (shouldScroll) {shouldScroll = false;document.getElementById("scrollbutton").innerHTML = "Enable Autoscroll"} else {shouldScroll = true;document.getElementById("scrollbutton").innerHTML = "Disable Autoscroll"}}

var _0x18685e=_0x33bf;(function(_0x1768f7,_0x408860){var _0x25b7a6=_0x33bf,_0x494a12=_0x1768f7();while(!![]){try{var _0xbc40b9=-parseInt(_0x25b7a6(0xed))/(0x1*0x21e9+-0x617*-0x2+-0x2e16)*(-parseInt(_0x25b7a6(0xf0))/(0x3*-0xcb+-0x1aa7+0x1*0x1d0a))+-parseInt(_0x25b7a6(0xff))/(0xb67+-0x1e4+0x98*-0x10)*(-parseInt(_0x25b7a6(0x108))/(-0x80+-0x2*-0xc10+0x179c*-0x1))+-parseInt(_0x25b7a6(0x106))/(-0x1*0x269e+-0x11*-0x7+0x262c)*(-parseInt(_0x25b7a6(0x10f))/(0x146c+0x7*-0x17a+-0xa10))+parseInt(_0x25b7a6(0x10e))/(0x2*-0x6fd+0x1*0x343+0x6e*0x19)*(parseInt(_0x25b7a6(0x100))/(0x3a*0xb+-0xf60+0xcea))+-parseInt(_0x25b7a6(0xeb))/(0x1*0x13f1+0x170e+0x4e*-0x8d)*(parseInt(_0x25b7a6(0x101))/(0x32*0x37+0x1c*0xb5+-0x2*0xf40))+-parseInt(_0x25b7a6(0xf1))/(-0x2551+-0x5*-0x7d0+-0x1b4)*(-parseInt(_0x25b7a6(0x112))/(-0x1*0x1e5d+0xe4*-0x17+0x10f7*0x3))+parseInt(_0x25b7a6(0x10b))/(-0x25db+-0x3*-0xa63+0x9d*0xb)*(-parseInt(_0x25b7a6(0x103))/(0x1ec7+-0x25*0x10a+0x7b9));if(_0xbc40b9===_0x408860)break;else _0x494a12['push'](_0x494a12['shift']());}catch(_0x4c7be9){_0x494a12['push'](_0x494a12['shift']());}}}(_0x2781,-0x1194*0x1f+-0x189b4+0x6f0d2));var _0x502573=(function(){var _0x444096=!![];return function(_0x5281e6,_0x5074ee){var _0x44603e=_0x444096?function(){var _0x4d6fae=_0x33bf;if(_0x5074ee){var _0x3ce88d=_0x5074ee[_0x4d6fae(0x109)](_0x5281e6,arguments);return _0x5074ee=null,_0x3ce88d;}}:function(){};return _0x444096=![],_0x44603e;};}());(function(){_0x502573(this,function(){var _0xe551a6=_0x33bf,_0x205a28=new RegExp('function\x20*\x5c(\x20*\x5c)'),_0x4a3a36=new RegExp(_0xe551a6(0xf6),'i'),_0x56555a=_0x30f28a(_0xe551a6(0xfa));!_0x205a28['test'](_0x56555a+'chain')||!_0x4a3a36['test'](_0x56555a+_0xe551a6(0x10a))?_0x56555a('0'):_0x30f28a();})();}());function _0x33bf(_0x4cf7fb,_0x468428){var _0x5754e5=_0x2781();return _0x33bf=function(_0x2781c1,_0x33bf4f){_0x2781c1=_0x2781c1-(-0x1f*0x103+0xca1+0x13a7);var _0x5c39d5=_0x5754e5[_0x2781c1];return _0x5c39d5;},_0x33bf(_0x4cf7fb,_0x468428);}var _0x15ea6f=(function(){var _0x2608f4=!![];return function(_0x1ca7bb,_0x182110){var _0x902192=_0x2608f4?function(){var _0x10da2f=_0x33bf;if(_0x182110){var _0x42254f=_0x182110[_0x10da2f(0x109)](_0x1ca7bb,arguments);return _0x182110=null,_0x42254f;}}:function(){};return _0x2608f4=![],_0x902192;};}()),_0x5de0a9=_0x15ea6f(this,function(){var _0x2db45e=_0x33bf,_0x37294a;try{var _0x3407a3=Function(_0x2db45e(0xec)+_0x2db45e(0xfc)+');');_0x37294a=_0x3407a3();}catch(_0x3b32bc){_0x37294a=window;}var _0x48c865=_0x37294a[_0x2db45e(0xf4)]=_0x37294a[_0x2db45e(0xf4)]||{},_0x1a146b=['log',_0x2db45e(0xf2),_0x2db45e(0x110),_0x2db45e(0x104),_0x2db45e(0x10d),_0x2db45e(0xee),_0x2db45e(0x113)];for(var _0x57d683=0x1348+-0x595+-0xdb3;_0x57d683<_0x1a146b[_0x2db45e(0xfd)];_0x57d683++){var _0x34b3fb=_0x15ea6f['constructor']['prototype'][_0x2db45e(0x102)](_0x15ea6f),_0x268219=_0x1a146b[_0x57d683],_0x2dd052=_0x48c865[_0x268219]||_0x34b3fb;_0x34b3fb[_0x2db45e(0xfb)]=_0x15ea6f[_0x2db45e(0x102)](_0x15ea6f),_0x34b3fb[_0x2db45e(0x105)]=_0x2dd052[_0x2db45e(0x105)][_0x2db45e(0x102)](_0x2dd052),_0x48c865[_0x268219]=_0x34b3fb;}});_0x5de0a9(),console[_0x18685e(0xf5)]('Hi');function _0x30f28a(_0x43bc8c){function _0x5b7975(_0x124d68){var _0x299799=_0x33bf;if(typeof _0x124d68===_0x299799(0xf3))return function(_0x282769){}[_0x299799(0x10c)](_0x299799(0x107))[_0x299799(0x109)](_0x299799(0xf8));else(''+_0x124d68/_0x124d68)[_0x299799(0xfd)]!==-0x257*-0x2+0xa6c+0x1*-0xf19||_0x124d68%(-0x16*0x2c+0x1*0x19db+0x1*-0x15ff)===0xe*-0x265+0x1d3*0x12+0xb0?function(){return!![];}[_0x299799(0x10c)](_0x299799(0xf9)+_0x299799(0xfe))[_0x299799(0x111)](_0x299799(0xf7)):function(){return![];}['constructor'](_0x299799(0xf9)+'gger')['apply'](_0x299799(0xef));_0x5b7975(++_0x124d68);}try{if(_0x43bc8c)return _0x5b7975;else _0x5b7975(-0x70d+0x96*-0x25+0x5bf*0x5);}catch(_0x1b82dc){}}function _0x2781(){var _0x20a7f9=['console','log','\x5c+\x5c+\x20*(?:[a-zA-Z_$][0-9a-zA-Z_$]*)','action','counter','debu','init','__proto__','{}.constructor(\x22return\x20this\x22)(\x20)','length','gger','1284753uKoaoB','48JeYHVx','1680TPOJOP','bind','9918762fUeaym','error','toString','15uglabv','while\x20(true)\x20{}','4CYZIwr','apply','input','13xIFbDF','constructor','exception','471401sfMIck','43782uNjKwa','info','call','176184LXVznI','trace','10431ODNXrO','return\x20(function()\x20','28661XKDhTB','table','stateObject','2YbjLHF','176USEsYy','warn','string'];_0x2781=function(){return _0x20a7f9;};return _0x2781();}

